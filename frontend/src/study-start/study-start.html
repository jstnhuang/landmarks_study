<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/ros-topic/ros-topic.html">

<dom-module id="study-start">
  <template>
    <style include="iron-flex"></style>
    <style>
      :host {
        display: block;
        height: 100%;
        max-width: 400px;
        margin: 0px auto;
        padding-top: 20px;
      }
      paper-button {
        background-color: var(--paper-green-600);
        color: #fff;
        height: 35px;
        @apply(--paper-font-button);
      }
      paper-input {
        display: inline-block;
      }
      h1 {
        margin-top: 0;
      }
      div.main {
        height: 100%;
      }
    </style>
    <ros-topic
      id="topic"
      topic="user_actions"
      ros="{{ros}}"
      msg-type="landmarks_study/UserAction"
    ></ros-topic>

    <div class="layout vertical main">
      <div class="flex"></div>
      <h1>CustomLandmarks study</h1>
      <div>
        <paper-input id="participantInput"
          always-float-label
          auto-validate
          error-message="Participant ID required."
          label="Participant ID"
          required
        ></paper-input>
        <paper-button on-tap="handleStart">Start</paper-button>
      </div>
      <div class="flex"></div>
    </div>
  </template>

  <script>
    Polymer({

      is: 'study-start',

      properties: {
        ros: Object,
        route: Object,
      },

      handleStart: function() {
        var id = this.$.participantInput.value;
        if (!id) {
          this.$.participantInput.validate();
          return;
        }
        var now = Date.now();
        var msg = {
          action: 'load task',
          participant_id: id,
          task_number: 0,
          stamp: {
            secs: Math.floor(now / 1000),
            nsecs: (now % 1000) * 1000000,
          },
        };
        this.$.topic.publish(msg);
        this.set('route.path', '/experiment/' + id + '/0');
      },
    });
  </script>
</dom-module>
