<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/ros-topic/ros-topic.html">

<dom-module id="study-start">
  <template>
    <style>
      :host {
        display: block;
        max-width: 500px;
        margin: 0px auto;
        padding-top: 20px;
      }
      paper-input {
        display: inline-block;
      }
      h1 {
        margin-top: 0;
      }
    </style>
    <app-location route="{{route}}"></app-location>
    <app-route
      route="{{route}}"
      pattern="/:view"
      data="{{routeData}}"
    ></app-route>
    <ros-topic
      id="topic"
      topic="user_actions"
      ros="{{ros}}"
      msg-type="landmarks_study/UserAction"
    ></ros-topic>

    <h1>CustomLandmarks study</h1>
    <paper-input id="participantInput"
      always-float-label
      auto-validate
      error-message="Participant ID required."
      label="Participant ID"
      required
    ></paper-input>
    <paper-button on-tap="handleStart">Start</paper-button>
  </template>

  <script>
    Polymer({

      is: 'study-start',

      properties: {
        route: Object,
      },

      handleStart: function() {
        var id = this.$.participantInput.value;
        if (!id) {
          this.$.participantInput.validate();
          return;
        }
        var now = Date.now();
        var msg = {
          action: 'load task',
          participant_id: id,
          task_number: 0,
          stamp: {
            secs: Math.floor(now / 1000),
            nsecs: (now % 1000) * 1000000,
          },
        };
        this.$.topic.publish(msg);
      },
    });
  </script>
</dom-module>
